## Математические основы алгоритмов деревьев решений

### 1. Критерии разбиения

#### Для классификации

- **Gini Impurity**: Измеряет степень "смешивания" классов в узле. Чем ниже значение, тем более однородным является узел.
  
Формула Gini Impurity:

\[
Gini = 1 - \sum_{i=1}^{C} p_i^2
\]

где:
- \(C\) — количество классов,
- \(p_i\) — доля класса \(i\) в узле.

#### Для регрессии

- **Сумма квадратов ошибок (MSE)**: Минимизирует общую сумму квадратов ошибок.

Формула MSE:

\[
MSE = \frac{1}{m} \sum_{i=1}^{m} (Y_i - \hat{Y_i})^2
\]

где:
- \(m\) — количество наблюдений,
- \(Y_i\) — фактические значения,
- \(\hat{Y_i}\) — предсказанные значения.

### 2. Разбиение узлов

Алгоритм ищет лучший признак и значение, при котором функция потерь (например, Gini или MSE) достигает минимума после разбиения. Это можно описать следующим образом:

Для каждого узла \(t\):

1. Рассмотрим все возможные разбиения по всем признакам \(X_j\):
   - Для каждого возможного порога \(p\) (например, для \(X_j\)):
   - Разделите набор данных на две группы: \(G_1\) и \(G_2\).
   
2. Рассчитайте критерий разбиения:
   - Для классификации:
   
\[
Gain = Gini(t) - \left( \frac{|G_1|}{|t|} Gini(G_1) + \frac{|G_2|}{|t|} Gini(G_2) \right)
\]

   - Для регрессии:
   
\[
Gain = MSE(t) - \left( \frac{|G_1|}{|t|} MSE(G_1) + \frac{|G_2|}{|t|} MSE(G_2) \right)
\]

### 3. Рекурсивное разбиение
Процесс рекурсивного разбиения продолжается, пока не будет достигнуто одно из условий остановки:

- Максимальная глубина дерева.
- Минимальное количество образцов в узле.
- Чистота узла (классы полностью разделены).

### 4. Прореживание (Pruning)
После построения дерева используется метод прореживания для уменьшения сложности модели и предотвращения переобучения. Методы:
- **Постпрореживание**: Удаление узлов, которые не улучшают качество на валидационном наборе данных.
- **Предварительное прореживание**: Условия остановки, которые не позволяют дереву стать слишком сложным.

### 5. Гиперпараметры
Оптимизация включает в себя выбор гиперпараметров, таких как:
- Максимальная глубина дерева.
- Минимальное количество образцов для разбиения.
- Минимальное количество образцов в листе.

### Заключение
Деревья решений основываются на четких математических принципах, связанных с оценкой разбиений и критериям потерь. Эти аспекты важны для понимания, как алгоритмы принимают решения и как они могут быть оптимизированы для повышения производительности. Если вам нужны дополнительные детали или примеры, дайте знать!
